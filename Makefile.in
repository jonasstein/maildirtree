# $Id: Makefile.in,v 1.4 2003/09/07 02:21:17 joshk Exp $
# Small Makefile to ease building of maildirtree

# Used for make dist
VERSION = @PACKAGE_VERSION@
exclusions = .cvsignore autogen.sh CVS

CC = @CC@
CFLAGS = @CFLAGS@
INSTALL = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@

maildirtree: maildirtree.c maildirtree.h config.h
	$(CC) $(CFLAGS) maildirtree.c -o $@

config.h:
	sh configure

clean:
	rm -f *.o maildirtree core a.out

distclean: clean
	rm -f Makefile config.log config.status config.h *~
	rm -rf autom4te.cache

install: maildirtree
	if test ! -d "$(DESTDIR)$(bindir)"; then mkdir $(DESTDIR)$(bindir); fi
	$(INSTALL_PROGRAM) -m 755 $< $(DESTDIR)$(bindir)/

uninstall:
	rm -f $(DESTDIR)$(bindir)/maildirtree

dist: distclean
	autoheader
	autoconf
	rm -rf autom4te.cache *~
ifeq (,$(wildcard install-sh))
	cp -f /usr/share/automake/install-sh .
endif
	(cd .. && ln -sf $(CURDIR) maildirtree-$(VERSION))
	(cd .. && tar $(addprefix --exclude ,$(exclusions)) -chzf maildirtree-$(VERSION).tar.gz maildirtree-$(VERSION))
	rm -f ../maildirtree-$(VERSION)
	@echo; echo "Created source release $(VERSION):"; echo
	@md5sum ../maildirtree-$(VERSION).tar.gz
	@echo
	@tar tzvf ../maildirtree-$(VERSION).tar.gz
	@echo
	rm -f ../maildirtree-$(VERSION).tar.gz.sign
	cd .. && gpg -o maildirtree-$(VERSION).tar.gz.sign --sign -a -b maildirtree-$(VERSION).tar.gz
	

.PHONY: clean distclean install uninstall dist
