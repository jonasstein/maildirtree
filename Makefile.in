# $Id: Makefile.in,v 1.6 2003/09/07 08:43:08 joshk Exp $
# Small Makefile to ease building of maildirtree

# Used for make dist
VERSION = @PACKAGE_VERSION@
NAME    = @PACKAGE_NAME@
exclusions = .cvsignore autogen.sh CVS

# Used for compilation targets
CC = @CC@
CFLAGS = @CFLAGS@ $(DEFS)
DEFS = -D_GNU_SOURCE
INSTALL = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@

# Used for installation
prefix = @prefix@
exec_prefix = @exec_prefix@
bindir = @bindir@
mandir = @mandir@

default: all

all: maildirtree maildirtree.1.gz

maildirtree.1.gz: maildirtree.1
	gzip -9c $< > $@

maildirtree.1: maildirtree.1.sgml
	docbook-to-man $< > $@

maildirtree: maildirtree.c maildirtree.h config.h
	$(CC) $(CFLAGS) maildirtree.c -o $@

config.h:
	sh configure

clean:
	rm -f *.o maildirtree maildirtree.1 maildirtree.1.gz core a.out

distclean: clean
	rm -f Makefile config.log config.status config.h *~
	rm -rf autom4te.cache

install: maildirtree
	$(INSTALL) -d $(DESTDIR)$(bindir)
	$(INSTALL) -d $(DESTDIR)$(mandir)/man1/
	$(INSTALL_PROGRAM) -m 755 $< $(DESTDIR)$(bindir)/
	$(INSTALL) -m 644 maildirtree.1.gz $(DESTDIR)$(mandir)/man1/

uninstall:
	rm -f $(DESTDIR)$(bindir)/maildirtree
	rm -f $(DESTDIR)$(mandir)/man1/maildirtree.1.gz

dist: distclean
	autoheader
	autoconf
	rm -rf autom4te.cache *~
ifeq (,$(wildcard install-sh))
	cp -f /usr/share/automake/install-sh .
endif
	(cd .. && ln -sf $(CURDIR) $(NAME)-$(VERSION))
	(cd .. && tar $(addprefix --exclude ,$(exclusions)) -chzf $(NAME)-$(VERSION).tar.gz $(NAME)-$(VERSION))
	rm -f ../$(NAME)-$(VERSION)
	@echo; echo "Created source release $(VERSION):"; echo
	@md5sum ../$(NAME)-$(VERSION).tar.gz
	@echo
	@tar tzvf ../$(NAME)-$(VERSION).tar.gz
	@echo
	rm -f ../$(NAME)-$(VERSION).tar.gz.sign
	cd .. && gpg -o $(NAME)-$(VERSION).tar.gz.sign --sign -a -b $(NAME)-$(VERSION).tar.gz
	

.PHONY: clean distclean install uninstall dist
